# 第十章：Agent Loop 运行内核剖析

本章聚焦 Agent Loop 的执行主链：请求如何进入、上下文如何组装、工具如何被调度、结果如何流式返回。理解这条主链，是定位复杂故障与优化执行效率的关键。

**本章学习目标**

- 理解入口排队与并发控制机制。
- 掌握提示词组装与系统指令注入方式。
- 理解工具执行与消息回注闭环。
- 建立流式输出与重试策略的调优方法。

**阅读建议** 阅读时建议同时画出本地系统的执行链路图，并在每个环节标注可观测指标与失败处理策略。 **章节地图**

- [10.1 入口、排队与并发控制](10.1_entry_queue.md)
- [10.2 提示词组装与系统提示注入](10.2_prompt_assembly.md)
- [10.3 工具执行链路与结果回注](10.3_tool_execution.md)
- [10.4 流式输出、重试与提前终止](10.4_streaming_retry.md)
- [本章小结](summary.md)
