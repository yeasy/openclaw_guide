## 11.2 冷却与禁用：故障窗口内的止血机制

本节以官方 failover 语义为准，讲清故障窗口内的止血手段：回退链路负责把请求切到可用目标；冷却与禁用负责抑制重试放大；恢复依赖探针与观测，而不是盲目全量放开。重点是把“回退配置”和“冷却机制”放在正确层次实现。

### 11.2.1 冷却解决什么：防止重试放大

在供应商抖动或限流时，如果系统持续对同一目标重试，会出现放大链条：失败触发重试，重试挤占并发与配额，队列堆积导致端到端超时。

冷却的目标是在故障窗口内降低无效尝试，把资源留给仍可能成功的路径。

### 11.2.2 回退落点：fallbacks 顺序尝试

官方 failover 配置通过 `fallbacks` 字符串列表描述“遇到错误时回退的模型顺序”，同时也在同供应商内支持鉴权配置的自动轮转。参考：https://docs.openclaw.ai/concepts/model-failover。

配置示例：

```json5
{
  agents: {
    defaults: {
      model: {
        primary: 'openai/gpt-5.2',
        fallbacks: [
          'openai/gpt-5-mini',
          'anthropic/claude-sonnet-4-5',
        ],
      },
    },
  },
}
```

### 11.2.3 冷却与禁用的实现层：重试/调度层而非模型字段

当前官方 `fallbacks` 不提供 `cooldownSeconds` 字段。工程上通常在运行层实现冷却与禁用：

- 为特定错误类型设置重试预算（次数、总时长、退避）。
- 对持续失败的目标做临时禁用窗口（短时间不再尝试）。
- 用探针确认恢复后再逐步放量。

操作示例：

```bash
openclaw models status --check
openclaw status --deep
```

### 11.2.4 验收与排障

- 如果回退频繁发生但主链路看起来正常，优先检查错误分类与重试预算是否过宽。
- 如果回退不发生，优先检查失败错误是否足够严重到触发模型层面的切换，或是否触发了供应商级别内的 profile rotation。
- 如果故障已恢复但仍长时间走备用链路，优先检查恢复探针与禁用窗口逻辑。

官方参考：https://docs.openclaw.ai/concepts/model-failover
