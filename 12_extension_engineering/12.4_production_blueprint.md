## 12.4 生产落地蓝图：扩展可控化

扩展进入生产后，风险主要来自三处：扩展本身引入的新能力、配置叠加后的边界漂移、以及排障时的不可回放。本节给出一套面向 OpenClaw 的生产落地蓝图，强调把插件、工具策略、密钥注入、日志脱敏与验收命令固化为流程，让扩展的生命周期可控、可审计、可回滚。

### 12.4.1 发布与回滚：配置即代码，启停即开关

生产落地建议把扩展拆为两类变更并分别治理：

1. 代码变更：插件版本升级，进入常规发布流程。
2. 配置变更：插件启停、白名单、工具策略与渠道策略，进入配置发布流程。

官方插件体系支持通过 `enabled` 显式启停插件，并通过 `plugins.allow` 与 `plugins.deny` 收敛可加载范围：[https://docs.openclaw.ai/zh-CN/tools/plugin](https://docs.openclaw.ai/zh-CN/tools/plugin)。

实践中建议把“回滚”设计为优先级最高的动作：出现异常时先停插件或收敛白名单，再回滚版本，减少故障扩散。

### 12.4.2 安全基线：白名单、拒绝优先与密钥环境注入

扩展能力的安全边界建议采用三层收敛：

1. 插件白名单：只允许经过审计的插件加载。
2. 工具策略：默认拒绝高风险工具组，拒绝规则优先。
3. 密钥注入：所有密钥用 `ENV:` 从环境变量注入，避免明文入库。

相关机制在官方安全与配置文档中有明确说明：

- 安全建议：[https://docs.openclaw.ai/zh-CN/gateway/security](https://docs.openclaw.ai/zh-CN/gateway/security)
- 配置参考：[https://docs.openclaw.ai/zh-CN/gateway/configuration](https://docs.openclaw.ai/zh-CN/gateway/configuration)
- 工具治理：[https://docs.openclaw.ai/zh-CN/tools](https://docs.openclaw.ai/zh-CN/tools)

为了避免排障数据成为新的泄露通道，建议启用日志脱敏与屏蔽环境变量输出，并把诊断输出落到受控路径。

### 12.4.3 可靠性与降级：把不可用变为可用

扩展进入生产后，最常见的不可用来自上游依赖与模型供应商。建议将降级能力前置为配置：

- 结合重试策略，对瞬时错误做有界重试，并对不可重试错误快速失败：[https://docs.openclaw.ai/zh-CN/concepts/retry](https://docs.openclaw.ai/zh-CN/concepts/retry)。
- 结合模型故障切换，为关键智能体配置回退链路，避免单点供应商故障：[https://docs.openclaw.ai/zh-CN/concepts/model-failover](https://docs.openclaw.ai/zh-CN/concepts/model-failover)。

同时应将结构化日志与告警联动，确保回退与降级发生时可被快速感知与定位。

### 12.4.4 运维与验收清单：把“能跑”变成“可证明”

建议将以下命令作为生产环境的日常验收与排障入口，并在扩展发布或配置变更后强制执行：

```bash
openclaw doctor
openclaw health --json
openclaw status --deep
openclaw plugins doctor
openclaw channels status --probe
openclaw models status --check
openclaw logs --follow --json
```

如果需要对外发布通知或批量投递结果，建议结合广播组并严格限制触发入口，相关配置见第7章的 [7.4 协作模式：子智能体与广播组](../07_multi_agent/7.4_collaboration_patterns.md)。

### 12.4.5 本节小结

生产落地的核心是可控化：插件以显式启停与白名单治理，工具以拒绝优先的策略治理，密钥以环境注入治理，日志以结构化与脱敏治理。将自检、探针与诊断命令固化为流程，可以把扩展从“上线后靠运气”变为“上线前可证明、上线后可回放”。
