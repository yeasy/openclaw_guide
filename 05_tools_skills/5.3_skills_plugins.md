## 5.3 技能机制：借助内置库固化指令

工具决定“能做什么”，而工程化的方法决定“如何更稳地做”。
插件与技能并行使用，能力与方法互补。
插件负责扩展运行时能力与工具，技能负责固化可复用的方法论与执行步骤。
新项目通常两者配合使用，而不是互相替代。

### 5.3.1 定位与分工：插件扩展能力，技能固化方法

在系统边界上可以把职责拆成两层：

1. 能力层：由插件提供，表现为新增工具、运行时组件或控制面扩展。
2. 方法层：由技能提供，表现为对常见任务的步骤、约束、失败处理与验收标准的固化。

如果需求涉及新增外部接口或执行能力，用插件；如果需求是让团队按统一方法稳定执行，用技能。

### 5.3.2 插件管理：安装、启用、白名单与自检

插件体系的核心是“显式启用与显式允许”。官方插件文档给出了 `plugins.entries` 的配置结构，以及 `plugins.allow`、`plugins.deny` 的白名单机制。

插件启用常见写法如下：

```json
{
  plugins: {
    entries: {
      'com.example.my_plugin': {
        enabled: true,
        config: {
          // 插件自定义配置
        },
      },
    },
    allow: ['com.example.my_plugin'],
  },
}
```

上线前建议把插件自检纳入验收流程：

- `plugins list`
- `plugins doctor`
- `status --deep`

> 说明：有的部署会要求在这些子命令前加上“主命令前缀”；若执行时报“找不到命令”，优先参考你本地 CLI 的帮助与本书其他章节的写法。

### 5.3.3 技能文件与 ClawHub：从安装到调用

技能用于把高频任务沉淀为“可执行步骤 + 约束 + 验收标准”的文档化流程，便于复用与交接。ClawHub 用于分发与管理技能，可按关键词检索并拉取已维护的技能包（具体能力与命令以实际版本为准）。

示例：

```bash
skills list --eligible "daily report"
agent --message "调用 daily-report（传入日期、数据源等参数）"
```

下面给出一个自编写的简化技能模板：

```markdown
# 渠道自检

本节提供了自检方式。

## 适用场景

渠道不回消息、群聊不触发、配对异常。

## 步骤

1. 先跑 `doctor --repair`。
2. 再跑 `channels status --probe`。
3. 若仍异常，跟随 `logs --follow --json` 过滤 `routed` 与 `tool_denied` 事件。

## 输出要求

必须给出命令、预期输出、异常分支与下一步。
```

> 注意：技能是方法说明，不是工具权限边界；是否允许执行高风险工具仍由工具策略与沙箱决定。

### 5.3.4 治理建议：用工具策略兜边界，用技能提稳定性

- 用工具策略做允许、拒绝与分层治理，拒绝规则优先于允许规则，避免越权。详见 [5.2 工具策略：允许、拒绝与分层策略](../05_tools_skills/5.2_tool_policy.md)。
- 用插件白名单控制可加载扩展集合，避免未经审计的扩展引入高风险能力。
- 用技能沉淀高频流程，减少人工排障时的波动与遗漏。

延伸阅读：

- Prompt 工程指南：https://github.com/yeasy/prompt_engineering_guide
- Context 工程指南：https://github.com/yeasy/context_engineering_guide
