## 7.4 协作模式：子智能体与广播组

多智能体不仅用于入口路由，也用于把复杂任务拆成可并行的子任务，并把结果投递到多个目标群或多个对端。本节基于 OpenClaw 的子智能体与广播组能力，给出两种常用协作模式的配置骨架与验收命令，并补充一套面向工程交付的交接协议，避免协作在“口头描述”上失真。

### 7.4.1 子智能体：并行拆解与汇总

子智能体用于把一个任务拆成多个可并行的分支，让主智能体做协调与汇总。官方文档提供了子智能体的配置入口与行为描述，并给出了在某个智能体下声明 `subagents` 的写法：[https://docs.openclaw.ai/zh-CN/agents/multi-agent/subagents](https://docs.openclaw.ai/zh-CN/agents/multi-agent/subagents)。

**具体例子：客服意图路由与权限物理隔离**
设计一个主入口智能体 `CustomerReception`，它自身不绑定任何外部写的工具，只负责安抚用户并判断意图：
- 当识别到用户说“我要退款”时，它将任务及订单号移交给拥有内网支付系统写入权限的子智能体 `RefundAgent`。
- 当用户说“接口一直报 500”时，它移交给拥有只读日志查询权限的子智能体 `TechSupport`。
这种模式通过物理隔离保证了即使作为主入口的智能体受到“提示词注入攻击（Prompt Injection）”，也无法直接执行越权的高危指令。

下面示例展示了另一个常见模式：`work` 负责总控与汇总，`research` 与 `writer` 分别负责资料搜集与成稿整理。

```json5
{
  agents: {
    work: {
      subagents: [
        { agentId: "research", name: "资料搜集" },
        { agentId: "writer", name: "成稿整理" }
      ]
    }
  }
}
```

子智能体的工程价值在于边界清晰：每个子智能体可以配套不同的工具策略与记忆策略，从而在“能力”与“风险”之间做收敛。

### 7.4.2 广播组：把结果投递到多个目标

广播组用于把同一条输出发送到多个目标群或多个对端，适合“发布通知、同步进展、批量告警”这类场景。官方文档给出了广播组的配置结构与字段含义：[https://docs.openclaw.ai/zh-CN/agents/multi-agent/broadcast-groups](https://docs.openclaw.ai/zh-CN/agents/multi-agent/broadcast-groups)。

下面示例展示了一个广播组，将消息同时投递到两个 WhatsApp 群与一个 Telegram 群。

```json5
{
  groups: {
    broadcastGroups: {
      ops_broadcast: {
        targets: [
          { channelId: "whatsapp", groupId: "120363000000000000@g.us" },
          { channelId: "whatsapp", groupId: "120363000000000001@g.us" },
          { channelId: "telegram", groupId: "-1001234567890" }
        ]
      }
    }
  }
}
```

广播属于高影响动作，建议与工具策略配合使用：默认只允许特定智能体触发广播，并在日志中记录广播组名、目标清单摘要与触发原因，便于审计与回滚。

### 7.4.3 交接协议：把协作结果写成可复验的结构

协作最常见的失败不是模型能力不足，而是交接信息不完整，导致主智能体无法验证子任务结果或无法继续执行。建议把交接协议固定成结构化模板，至少包含以下字段：

1. 结论：一句话结论与适用范围。
2. 证据：来源链接或日志线索，必要时附 `traceId`。
3. 操作：可执行命令或配置片段。
4. 验证：预期输出与异常分支的下一步。

下面给出一个可复用的交接模板，适合在子智能体完成后回传给主智能体或写入审计记录。

```text
交接摘要
- 结论：
- 证据：
- 已执行命令：
- 建议执行命令：
- 验证点：
- 风险与回滚：
```

### 7.4.4 验收与排障：先看配置是否加载，再看链路是否命中

多智能体协作的排障顺序建议固定为：

1. 用 `status --deep` 确认子智能体与广播组配置是否被加载。
2. 用 `channels status --probe` 确认目标渠道在线。
3. 用结构化日志按 `traceId` 回放一次完整协作链路。

```bash
openclaw status --deep
openclaw channels status --probe
openclaw logs --follow --json
```

如果出现“子智能体不工作”，优先检查 `subagents` 声明是否在正确的智能体下；如果出现“广播未送达”，优先检查目标群标识、渠道在线状态与入口门控策略是否拦截。

### 7.4.5 本节小结

子智能体用于把复杂任务并行化并保持边界清晰，广播组用于把结果稳定投递到多个目标。两者都应配合工具策略与结构化日志使用，把协作做成可审计、可回放链路。通过固定交接协议模板，可以显著减少协作中的信息丢失与不可复验问题。
