## 2.2 安装 OpenClaw：npm 与 pnpm

本节介绍开发机与交付环境的安装选择与版本治理要点。

### 2.2.1 选型规则：开发机与交付环境

- 开发机长期使用：优先全局安装 CLI，并固定版本号。
- 团队交付与生产：优先容器化或固定制品，避免临时拉取与不受控升级。
- npm：系统自带、兼容性最好，适合快速试用与最小变更路径。
- pnpm：安装快、占用小、对依赖更严格，适合团队统一与多项目环境（但务必统一版本与仓库策略）。

### 2.2.2 核心原则：不要混用包管理器

> [!WARNING]
> 不要混用包管理器！如果一个项目同时存在 `package-lock.json` 和 `pnpm-lock.yaml`，很容易导致依赖解析不一致、复现困难与排障成本飙升。请团队在开始前统一达成一致，并只保留一种锁文件。

### 2.2.3 官方安装命令：npm 与 pnpm

如果你选择 pnpm，推荐先用 Node 自带的 Corepack 激活（避免“机器 A 有 pnpm、机器 B 没 pnpm”）：

```bash
corepack enable
corepack prepare pnpm@latest --activate
```

```bash
# npm 全局安装

npm install -g openclaw@latest

# pnpm 全局安装

pnpm add -g openclaw@latest
```

建议：测试与生产环境不要长期依赖 `latest`。更稳妥的做法是固定到明确版本，并把版本号写进交付文档与回归清单。

```bash
npm install -g openclaw@<version>
```

安装后建议立即做一次最小验证（确保命令可用且 PATH 正确）：

```bash
openclaw --version
openclaw --help
```

## 2.2.4 升级到最新版本

要升级到最新版本，只需重新运行全局安装命令并指定 `latest` 标签即可：

```bash
# 使用 npm 升级到最新版

npm install -g openclaw@latest

# 或使用 pnpm 升级到最新版

pnpm add -g openclaw@latest
```

## 2.2.5 版本治理：把版本当作配置

虽然可以随时升级到最新版，但升级策略的目标不是单纯用上新版本，而是确保升级可验证、可回滚。

- 固定版本：测试与生产环境使用明确版本号，不要长期依赖 `latest`。
- 先回归再升级：每次升级后，至少覆盖 `health`、`status`、渠道探针与模型探针。
- 出问题先回滚：如果新版本异常，直接全局安装上一稳定版本（例如 `npm install -g openclaw@<旧版本号>`），再做差异定位。

操作示例：升级后先跑一遍最小探测。

```bash
openclaw health --json
openclaw status --deep
openclaw channels status
# 可选：如果你已配置渠道，再做探针验证

openclaw channels status --probe
openclaw models status --check
```
